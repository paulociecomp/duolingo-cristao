<div class="max-w-lg mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <%= link_to track_path(@lesson.track.slug), class: "inline-flex items-center text-gray-400 hover:text-gray-200 mb-4" do %>
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Voltar para <%= @lesson.track.name %>
    <% end %>

    <div class="bg-[#1A2C32] rounded-2xl shadow-sm border border-[#37464F] p-6">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-14 h-14 rounded-xl bg-[#1CB0F6]/20 flex items-center justify-center">
          <span class="text-3xl">üìñ</span>
        </div>
        <div>
          <h1 class="text-xl font-bold text-white"><%= @lesson.name %></h1>
          <p class="text-gray-400 text-sm"><%= @lesson.unit.name %></p>
        </div>
      </div>

      <% if @lesson.description.present? %>
        <p class="text-gray-400 mb-4"><%= @lesson.description %></p>
      <% end %>

      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-1 text-gray-400">
          <span>üìù</span>
          <span><%= @exercises.size %> exerc√≠cios</span>
        </div>
        <div class="flex items-center gap-1 text-[#FFC800]">
          <span>‚≠ê</span>
          <span>+<%= @lesson.xp_reward %> XP</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Status -->
  <% if @completed %>
    <div class="bg-[#58CC02]/20 border border-[#58CC02]/50 rounded-xl p-6 mb-6 text-center">
      <div class="text-4xl mb-2">‚úÖ</div>
      <h2 class="text-lg font-bold text-[#58CC02] mb-1">Li√ß√£o Completa!</h2>
      <% if @best_attempt %>
        <p class="text-[#58CC02]/80 text-sm">
          Melhor pontua√ß√£o: <%= @best_attempt.score %>%
          <% if @best_attempt.perfect? %>
            <span class="ml-1">‚≠ê Perfeito!</span>
          <% end %>
        </p>
      <% end %>
    </div>

    <%= button_to start_lesson_path(@lesson), method: :post, class: "w-full bg-[#1CB0F6] hover:bg-[#0EA5E9] text-white font-semibold py-4 px-6 rounded-xl transition mb-4" do %>
      Praticar Novamente
    <% end %>
  <% elsif @attempt %>
    <div class="bg-[#FFC800]/20 border border-[#FFC800]/50 rounded-xl p-6 mb-6 text-center">
      <div class="text-4xl mb-2">‚ñ∂Ô∏è</div>
      <h2 class="text-lg font-bold text-[#FFC800] mb-1">Li√ß√£o em Andamento</h2>
      <p class="text-[#FFC800]/80 text-sm">Continue de onde parou</p>
    </div>

    <% next_exercise = @attempt.user_exercise_attempts.count %>
    <% next_exercise_obj = @exercises[next_exercise] || @exercises.first %>
    <%= link_to lesson_exercise_path(@lesson, next_exercise_obj), class: "block w-full bg-[#FFC800] hover:bg-[#E6B400] text-[#131F24] font-semibold py-4 px-6 rounded-xl transition text-center mb-4" do %>
      Continuar Li√ß√£o
    <% end %>
  <% else %>
    <%= button_to start_lesson_path(@lesson), method: :post, class: "w-full bg-[#58CC02] hover:bg-[#4CAF00] text-white font-semibold py-4 px-6 rounded-xl transition" do %>
      <div class="flex items-center justify-center gap-2">
        <span class="text-xl">‚ñ∂Ô∏è</span>
        <span>Iniciar Li√ß√£o</span>
      </div>
    <% end %>
  <% end %>

  <!-- Exercises Preview -->
  <div class="mt-8">
    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Exerc√≠cios</h3>
    <div class="space-y-2">
      <% @exercises.each_with_index do |exercise, index| %>
        <div class="flex items-center gap-3 bg-[#1A2C32] rounded-lg p-3 border border-[#37464F]">
          <div class="w-8 h-8 rounded-full bg-[#232F36] flex items-center justify-center text-sm font-medium text-gray-400">
            <%= index + 1 %>
          </div>
          <span class="text-xl"><%= exercise_type_icon(exercise.exercise_type) %></span>
          <span class="text-sm text-gray-400 capitalize"><%= exercise.exercise_type.humanize %></span>
        </div>
      <% end %>
    </div>
  </div>
</div>
